<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>일차방정식의 해(LV.1)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 680px; margin: 40px auto; padding: 0 16px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 18px; }

    .title { font-size: 22px; font-weight: 900; margin-bottom: 10px; }
    .eq { font-size: 30px; font-weight: 900; margin-top: 4px; }

    .row { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; align-items: center; }
    input { flex: 1; min-width: 220px; padding: 12px; font-size: 18px; }
    button { padding: 12px 14px; font-size: 16px; cursor: pointer; }
    button:disabled, input:disabled { cursor: not-allowed; opacity: 0.6; }

    .meta { color: #555; margin-top: 12px; display: flex; gap: 14px; flex-wrap: wrap; }
    .msg { margin-top: 12px; font-weight: 900; font-size: 18px; min-height: 26px; }
    .good { color: #0a7; }
    .bad { color: #c22; }
    .done { color: #1148cc; }

    .playerName { margin-top: 18px; text-align: center; font-weight: 900; font-size: 16px; color: #222; }
    .maker { margin-top: 6px; text-align: center; color: #777; font-size: 13px; }

    .startWrap { border: 1px solid #ddd; border-radius: 12px; padding: 18px; margin-bottom: 14px; }
    .startTitle { font-size: 20px; font-weight: 900; margin-bottom: 10px; }
    .startHint { color: #666; font-size: 13px; margin-top: 8px; }
    .hidden { display: none; }
  </style>
</head>
<body>

  <!-- 시작 화면 -->
  <div class="startWrap" id="startScreen">
    <div class="startTitle">이름을 입력하고 시작하세요</div>
    <div class="row">
      <input id="nameInput" type="text" placeholder="이름 입력" />
      <button id="startBtn">시작</button>
    </div>
    <div class="startHint">이름은 아래에 굵게 표시됩니다.</div>
  </div>

  <!-- 게임 화면 -->
  <div class="card hidden" id="gameScreen">
    <div class="title" id="title">일차방정식의 해(LV.1)</div>

    <div class="eq" id="eq">x + 3 = 10</div>

    <div class="row">
      <input id="ans" type="text" inputmode="text" placeholder="x 값 입력 (예: 7, -2, 5/2)" />
      <button id="check">확인</button>
      <button id="nextLevel" disabled>LV.2 도전</button>
    </div>

    <div class="meta">
      <div>정답 개수: <span id="correct">0</span> / 10</div>
      <div>현재 레벨 시도: <span id="tries">0</span></div>
    </div>

    <div class="msg" id="msg"></div>

    <div class="playerName" id="playerName"></div>
    <div class="maker">만든이 : 수학교사 문재윤</div>
  </div>

<script>
  const TARGET_CORRECT = 10;

  // 정수 범위(원하면 조절)
  const A_MIN = -20, A_MAX = 20;
  const B_MIN = -20, B_MAX = 20;

  // 상태
  let level = 1;
  let correct = 0;
  let tries = 0;
  let totalTries = 0;
  let done = false;
  let finishedAll = false;

  // 현재 문제
  let a = 0, b = 0, sol = 0, type = 0;

  // 정답 후 1초 대기 잠금
  let locked = false;
  let nextTimer = null;

  // DOM
  const startScreen = document.getElementById('startScreen');
  const gameScreen = document.getElementById('gameScreen');
  const nameInput = document.getElementById('nameInput');
  const startBtn = document.getElementById('startBtn');

  const titleEl = document.getElementById('title');
  const eqEl = document.getElementById('eq');
  const ansEl = document.getElementById('ans');
  const msgEl = document.getElementById('msg');
  const correctEl = document.getElementById('correct');
  const triesEl = document.getElementById('tries');
  const checkBtn = document.getElementById('check');
  const nextLevelBtn = document.getElementById('nextLevel');
  const playerNameEl = document.getElementById('playerName');

  function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function formatA(x) {
    return (x < 0) ? `(${x})` : String(x);
  }

  function parseUserNumber(s) {
    const raw = (s || '').trim();
    if (raw === '') return null;
    const noSpaces = raw.replace(/\s+/g, '');

    if (noSpaces.includes('/')) {
      const parts = noSpaces.split('/');
      if (parts.length !== 2) return null;
      const n = Number(parts[0]);
      const d = Number(parts[1]);
      if (!Number.isFinite(n) || !Number.isFinite(d) || d === 0) return null;
      if (!Number.isInteger(n) || !Number.isInteger(d)) return null;
      return n / d;
    }

    const x = Number(noSpaces);
    if (!Number.isFinite(x)) return null;
    return x;
  }

  function showMessage(text, cls) {
    msgEl.textContent = text;
    msgEl.className = 'msg ' + (cls || '');
  }

  function clearNextTimer() {
    if (nextTimer) {
      clearTimeout(nextTimer);
      nextTimer = null;
    }
  }

  function updateUI() {
    titleEl.textContent = `일차방정식의 해(LV.${level})`;

    correctEl.textContent = correct;
    triesEl.textContent = tries;

    const disableMain = finishedAll || done || locked;
    ansEl.disabled = disableMain;
    checkBtn.disabled = disableMain;

    if (finishedAll) {
      nextLevelBtn.disabled = true;
      nextLevelBtn.textContent = '완료';
    } else {
      nextLevelBtn.disabled = !(done && level === 1);
      nextLevelBtn.textContent = 'LV.2 도전';
    }
  }

  function makeProblem() {
    a = randInt(A_MIN, A_MAX);
    b = randInt(B_MIN, B_MAX);

    const aText = formatA(a);

    if (level === 1) {
      type = randInt(0, 1);
      if (type === 0) {
        eqEl.textContent = `x + ${aText} = ${b}`;
        sol = b - a;
      } else {
        eqEl.textContent = `${aText} + x = ${b}`;
        sol = b - a;
      }
    } else {
      type = randInt(2, 3);
      if (type === 2) {
        eqEl.textContent = `x - ${aText} = ${b}`;
        sol = b + a;
      } else {
        eqEl.textContent = `${aText} - x = ${b}`;
        sol = a - b;
      }
    }

    ansEl.value = '';
    showMessage('', '');
    ansEl.focus();
  }

  function scheduleNextProblem() {
    locked = true;
    updateUI();
    clearNextTimer();

    nextTimer = setTimeout(() => {
      locked = false;
      makeProblem();
      updateUI();
    }, 1000);
  }

  function finishLevel() {
    done = true;
    locked = false;
    clearNextTimer();

    eqEl.textContent = '완료!';

    if (level === 2) {
      finishedAll = true;
      showMessage(`LV.2까지 통과하였습니다. 총 시도는 ${totalTries}번입니다.`, 'done');
    } else {
      showMessage('통과하였습니다.', 'done');
    }

    updateUI();
  }

  function startLevel(lv) {
    level = lv;
    correct = 0;
    tries = 0;
    done = false;
    locked = false;
    clearNextTimer();

    showMessage('', '');
    makeProblem();
    updateUI();
  }

  function checkAnswer() {
    if (finishedAll || done || locked) return;

    const user = parseUserNumber(ansEl.value);
    if (user === null) {
      showMessage('x 값을 올바르게 입력해줘요.', 'bad');
      return;
    }

    tries += 1;
    totalTries += 1;

    if (Math.abs(user - sol) < 1e-9) {
      correct += 1;

      if (correct >= TARGET_CORRECT) {
        updateUI();
        finishLevel();
        return;
      }

      showMessage('정답입니다', 'good');
      updateUI();
      scheduleNextProblem();
    } else {
      showMessage('다시 생각해 보세요.', 'bad');
      updateUI();
      ansEl.select();
      ansEl.focus();
    }
  }

  function onNextLevelClick() {
    if (!(done && level === 1) || finishedAll) return;
    startLevel(2);
  }

  function startWithName() {
    const name = (nameInput.value || '').trim();
    if (name === '') {
      alert('이름을 입력해 주세요.');
      nameInput.focus();
      return;
    }

    playerNameEl.textContent = name;

    startScreen.classList.add('hidden');
    gameScreen.classList.remove('hidden');

    totalTries = 0;
    finishedAll = false;
    startLevel(1);
  }

  startBtn.addEventListener('click', startWithName);
  nameInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') startWithName();
  });

  checkBtn.addEventListener('click', checkAnswer);
  nextLevelBtn.addEventListener('click', onNextLevelClick);
  ansEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') checkAnswer();
  });
</script>
</body>
</html>
